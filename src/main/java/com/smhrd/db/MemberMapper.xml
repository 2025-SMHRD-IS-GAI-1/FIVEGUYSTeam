<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace: 관례상 DAO의 FQN을 쓰지만, 현재 DAO에서 id만 호출하므로 기존 값을 유지 -->
<mapper namespace="com.smhrd.model.MemberDAO">

  <!-- 회원가입 -->
  <insert id="join" parameterType="com.smhrd.model.MemberVO">
    INSERT INTO WEB_MEMBER (EMAIL, PW, TEL, ADDRESS)
    VALUES (#{email}, #{pw}, #{tel}, #{address})
  </insert>

  <!-- 로그인 -->
  <select id="login" parameterType="com.smhrd.model.MemberVO"
          resultType="com.smhrd.model.MemberVO">
    SELECT EMAIL, PW, TEL, ADDRESS
      FROM WEB_MEMBER
     WHERE EMAIL = #{email}
       AND PW    = #{pw}
       <!--  소프트 삭제를 도입했다면 AND DEL_YN='N' 조건을 추가하세요 -->
  </select>

  <!-- 전체 조회(관리용) -->
  <select id="selectAll" resultType="com.smhrd.model.MemberVO">
    SELECT EMAIL, TEL, ADDRESS
      FROM WEB_MEMBER
     WHERE EMAIL != 'admin'
  </select>

  <!-- 단일 조회: 이메일로 1명 -->
  <select id="selectByEmail" parameterType="string"
          resultType="com.smhrd.model.MemberVO">
    SELECT EMAIL, PW, TEL, ADDRESS
      FROM WEB_MEMBER
     WHERE EMAIL = #{email}
  </select>

  <!-- 프로필 수정: 연락처/주소 -->
  <update id="updateProfile" parameterType="com.smhrd.model.MemberVO">
    UPDATE WEB_MEMBER
       SET TEL     = #{tel},
           ADDRESS = #{address}
     WHERE EMAIL   = #{email}
  </update>

  <!-- 비밀번호 변경 -->
  <update id="updatePassword" parameterType="com.smhrd.model.MemberVO">
    UPDATE WEB_MEMBER
       SET PW    = #{pw}
     WHERE EMAIL = #{email}
  </update>

  <!-- (이메일 변경용) 신규 이메일 중복 체크 -->
  <select id="countByEmail" parameterType="string" resultType="int">
    SELECT COUNT(*) FROM WEB_MEMBER WHERE EMAIL = #{email}
  </select>

  <!-- (이메일 변경용) 현재 비번 확인 -->
  <select id="selectPwByEmail" parameterType="string" resultType="string">
    SELECT PW FROM WEB_MEMBER WHERE EMAIL = #{email}
  </select>

  <!-- 이메일 변경 (부모 테이블) -->
  <update id="updateEmail" parameterType="map">
    UPDATE WEB_MEMBER
       SET EMAIL = #{newEmail}
     WHERE EMAIL = #{oldEmail}
  </update>

  <!-- 회원 탈퇴(소프트 삭제) : DEL_YN을 쓰는 경우 -->
  <!--
  ALTER TABLE WEB_MEMBER ADD DEL_YN CHAR(1) DEFAULT 'N' NOT NULL;
  그리고 login 쿼리에 AND DEL_YN='N' 추가 권장
  -->
  <update id="softDelete" parameterType="map">
    UPDATE WEB_MEMBER
       SET DEL_YN = 'Y'
     WHERE EMAIL = #{email}
       AND PW    = #{pw}
  </update>

</mapper>
